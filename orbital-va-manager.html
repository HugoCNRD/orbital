<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Orbital VA – Manager Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root{
  --bg-main:#0b1020;
  --bg-panel:#111831;
  --bg-card:#161f3d;
  --accent-blue:#4da6ff;
  --accent-purple:#7b5cff;
  --text-main:#e6ebff;
  --text-muted:#9aa4d6;
  --success:#4cff9f;
}
body{
  margin:0;
  background:radial-gradient(circle at top,#111831,var(--bg-main));
  font-family:Poppins,sans-serif;
  color:var(--text-main);
}
.app{display:flex;min-height:100vh}
.sidebar{
  width:260px;
  background:linear-gradient(180deg,#0d1430,#0a0f24);
  padding:25px 15px;
}
.sidebar h2{
  font-family:Orbitron,sans-serif;
  text-align:center;
  color:var(--accent-blue);
  margin-bottom:35px;
}
.sidebar a{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 15px;
  margin-bottom:12px;
  color:var(--accent-purple);
  text-decoration:none;
  border-radius:12px;
}
.sidebar a:hover{background:rgba(77,166,255,.15)}
.main{flex:1;padding:40px}
h1{
  font-family:Orbitron,sans-serif;
  color:var(--accent-blue);
}
.muted{color:var(--text-muted);margin-bottom:30px}
.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:25px;
}
.card{
  background:linear-gradient(145deg,var(--bg-card),var(--bg-panel));
  border-radius:18px;
  padding:25px;
  text-align:center;
}
.card span{
  display:block;
  margin-top:12px;
  font-size:30px;
  font-weight:600;
  color:var(--success);
}
</style>
</head>

<body>

<div class="app">

  <!-- SIDEBAR -->
<nav class="sidebar">
  <h2>ORBITAL VA</h2>
<a href="orbital-va-manager.html">
    <i class="fas fa-chart-line"></i> Dashboard
  </a>
  <a href="va/orbital/stats.html">
    <i class="fas fa-chart-bar"></i> VA Statistics
  </a>
  <a href="va/orbital/pireps-validation.html">
    <i class="fas fa-clipboard-check"></i> PIREPs Validation
  </a>
  <a href="va/orbital/manager-leaderboard.html">
    <i class="fas fa-trophy"></i> Pilot Leaderboard
  </a>
  <a href="create-event.html">
    <i class="fas fa-calendar-plus"></i> New Event
  </a>
  <a href="va/orbital/manager-events.html">
    <i class="fas fa-calendar-alt"></i> VA Events
  </a>
  <a href="va/orbital/manager-routes.html">
    <i class="fas fa-route"></i> VA Routes
  </a>
  <a href="va/orbital/manager-pilots.html">
    <i class="fas fa-users"></i> Pilots List
  </a>
</nav>


  <!-- MAIN -->
  <main class="main">
    <h1>VA Dashboard</h1>
    <p class="muted">Orbital – Operational statistics</p>

    <div class="stats-grid">
      <div class="card">
        Total PIREPs
        <span id="totalPireps">0</span>
      </div>
      <div class="card">
        Total Flight Time
        <span id="totalTime">0h 0m</span>
      </div>
    </div>
  </main>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-KQGhyjrVhcstiQfqKcDQkiJjQQXf19M",
  authDomain: "orbital---va-manager.firebaseapp.com",
  projectId: "orbital---va-manager"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Convert duration string to minutes
function durationToMinutes(str){
  if(!str) return 0;
  let min = 0;
  const h = str.match(/(\d+)h/);
  const m = str.match(/(\d+)m/);
  if(h) min += parseInt(h[1]) * 60;
  if(m) min += parseInt(m[1]);
  return min;
}

onAuthStateChanged(auth, async user=>{
  if(!user){location.href="index.html";return;}

  // Check manager role
  const userSnap = await getDoc(doc(db,"users",user.uid));
  if(userSnap.data()?.role !== "manager"){
    alert("Access denied");
    location.href="home.html";
    return;
  }

  // Fetch VA PIREPs
  const q = query(
    collection(db,"pireps"),
    where("va","==","orbital")
  );

  const snap = await getDocs(q);

  let totalMinutes = 0;
  snap.forEach(d=>{
    totalMinutes += durationToMinutes(d.data().duration);
  });

  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;

  document.getElementById("totalPireps").innerText = snap.size;
  document.getElementById("totalTime").innerText = `${hours}h ${minutes}m`;
});
</script>

</body>
</html>






