<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orbital â€“ Sign In</title>
<link rel="icon" href="favicon.ico">

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<link rel="stylesheet" href="css/style.css">
<style>
/* Popup styles */
#signupPopup {
  display: none;
  position: fixed;
  top: 10%;
  left: 50%;
  transform: translateX(-50%);
  background: #1b1b2f;
  color: white;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
  z-index: 1000;
}
#signupPopup input, #signupPopup select {
  display: block;
  width: 100%;
  margin: 10px 0;
  padding: 8px;
  border-radius: 6px;
  border: none;
}
#signupPopup button { margin-top: 15px; }
</style>
</head>

<body>

<div class="login-container">
  <h1>Orbital VA Manager</h1>

  <!-- LOGIN FORM -->
  <form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>

  <p>Don't have an account yet? <a href="#" id="openSignup">Sign up!</a></p>
</div>

<!-- SIGNUP POPUP -->
<div id="signupPopup">
  <h2>Create Account</h2>
  <form id="signupForm">
    <input type="text" name="ifcUsername" placeholder="IFC Username" required>
    <input type="text" name="callsign" placeholder="VA Callsign" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Password" required>
    <select name="va" required>
      <option value="">Select VA</option>
      <option value="orbital">Orbital</option>
      <option value="testva">TestVA</option>
      <!-- Ajouter d'autres VA ici -->
    </select>
    <button type="submit">Create Account</button>
    <button type="button" id="closeSignup">Cancel</button>
  </form>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-KQGhyjrVhcstiQfqKcDQkiJjQQXf19M",
  authDomain: "orbital---va-manager.firebaseapp.com",
  projectId: "orbital---va-manager",
  storageBucket: "orbital---va-manager.firebasestorage.app",
  messagingSenderId: "162057702983",
  appId: "1:162057702983:web:f8ed3f5d115c7c53cbeb62"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// LOGIN
const loginForm = document.getElementById("loginForm");
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;
  try {
    await signInWithEmailAndPassword(auth, email, password);
    location.href = "home.html";
  } catch(err) {
    alert("Login failed: " + err.message);
  }
});

// SIGNUP POPUP
const signupPopup = document.getElementById("signupPopup");
document.getElementById("openSignup").onclick = () => signupPopup.style.display = "block";
document.getElementById("closeSignup").onclick = () => signupPopup.style.display = "none";

// SIGNUP FORM
const signupForm = document.getElementById("signupForm");
signupForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = signupForm.email.value;
  const password = signupForm.password.value;
  const ifcUsername = signupForm.ifcUsername.value;
  const callsign = signupForm.callsign.value;
  const va = signupForm.va.value;

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Ajouter dans Firestore
    await setDoc(doc(db, "users", user.uid), {
      ifcUsername,
      callsign,
      va,
      email,
      role: "pilot",
      pireps: 0
    });

    alert("Your account has been created! Enter your information to login.");
    signupForm.reset();
    signupPopup.style.display = "none";

  } catch(error) {
    alert("Error creating account: " + error.message);
  }
});
</script>

</body>
</html>



